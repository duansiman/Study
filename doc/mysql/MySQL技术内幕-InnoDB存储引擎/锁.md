锁机制用于管理对共享资源的并发访

### lock与latch
latch一般称为闩锁（轻量级的锁），因为其要求锁定的时间必须非常短
- latch又可以分为mutex（互斥量）和rwlock（读写锁）
- 通常没有死锁检测的机制

> SHOW ENGINE INNODB MUTEX

lock的对象是事务，用来锁定的是数据库中的对象，如表、页、行
- 仅在事务commit或rollback后进行释放
- 不同事务隔离级别释放的时间可能不同

> SHOWENGINE INNODB STATUS及information_schema架构下的
> 表INNODB_TRX、INNODB_LOCKS、INNODB_LOCK_WAITS来观察锁的信息

### 锁类型
两种标准的行级锁
- 共享锁（S Lock），允许事务读一行数据
- 排他锁（X Lock），允许事务删除或更新一行数据

|-|X|S|
|---|---|---|
|X|不兼容|不兼容|
|S|不兼容|兼容|

#### 意向锁
支持多粒度（granular）锁定，这种锁定允许事务在行级上的锁和表级上的锁同时存在
- 意向锁是将锁定的对象分为多个层次，意向锁意味着事务希望在更细粒度（fine granularity）上进行加锁

> 如果需要对页上的记录r进行上X锁，那么分别需要对数据库A、表、页上意向锁IX，最后对记录r上X锁

- 意向共享锁（IS Lock），事务想要获得一张表中某几行的共享锁
- 意向排他锁（IX Lock），事务想要获得一张表中某几行的排他锁

> 意向锁其实不会阻塞除全表扫以外的任何请求

`查看锁情况`
- 在InnoDB 1.0版本之前，用户只能通过命令SHOW FULL PROCESSLIST，SHOWENGINE INNODB STATUS等来查看当前数据库中锁的请求
- 从InnoDB1.0开始，在INFORMATION_SCHEMA架构下添加了表INNODB_TRX、INNODB_LOCKS、INNODB_LOCK_WAITS

> 通过表INNODB_LOCK_WAITS，可以很直观地反映当前事务的等待