### 概念
redo log 又称为重做日志。重做日志用来实现事务的持久性，即事务ACID中的D。
记录了对于InnoDB存储引擎的事务日志，使用重做日志恢复到掉电前的时刻，以此来保证数据的完整性。
> 重做日志文件记录的是关于每个页（Page）的更改的物理情况

#### 重做日志文件组
每个InnoDB存储引擎至少有1个重做日志文件组（group），每个文件组下至少有2个重做日志文件，如默认的ib_logfile0和ib_logfile1
> 为了得到更高的可靠性，用户可以设置多个的镜像日志组（mirrored log groups），
> 将不同的文件组放在不同的磁盘上，以此提高重做日志的高可用性

`日志写入逻辑`

在日志组中每个重做日志文件的大小一致，并以循环写入的方式运行。
> InnoDB存储引擎先写重做日志文件1，当达到文件的最后时，会切换至重做日志文件2，再当重做日志文件2也被写满时，会再切换到重做日志文件1中

从重做日志缓冲往磁盘写入时，是按512个字节，也就是一个扇区的大小进行写入。因为扇区是写入的最小单位，因此可以保证写入必定是成功的
> 写入重做日志文件的操作不是直接写，而是先写入一个重做日志缓冲（redo log buffer）中
> 主线程（master thread），知道在主线程中每秒会将重做日志缓冲写入磁盘的重做日志文件中，不论事务是否已经提交

`innodb_flush_log_at_trx_commit的有效值有0、1、2`
- 0代表当提交事务时，并不将事务的重做日志写入磁盘上的日志文件，而是等待主线程每秒的刷新
- 1表示在执行commit时将重做日志缓冲同步写到磁盘，即伴有fsync的调用
- 2表示将重做日志异步写到磁盘，即写到文件系统的缓存中

> 为了保证事务的ACID中的持久性，必须将innodb_flush_log_at_trx_commit设置为1，也就是每当有事务提交时，就必须确保事务都已经写入重做日志文件

`相关参数`

1. innodb_log_file_size指定每个重做日志文件的大小
> 在InnoDB1.2.x版本之前，重做日志文件总的大小不得大于等于4GB，而1.2.x版本将该限制扩大为了512GB
2. 参数innodb_log_files_in_group指定了日志文件组中重做日志文件的数量，默认为2
3. 参数innodb_mirrored_log_groups指定了日志镜像文件组的数量，默认为1
4. 参数innodb_log_group_home_dir指定了日志文件组所在路径，默认为./，表示在MySQL数据库的数据目录下
> 一方面重做日志文件不能设置得太大，如果设置得很大，在恢复时可能需要很长的时间
> 另一方面又不能设置得太小了，否则可能导致一个事务的日志需要多次切换重做日志文件; 
> 重做日志文件太小会导致频繁地发生async checkpoint，导致性能的抖动

> InnoDB：ERROR：the age of the last checkpoint is9433645，InnoDB：which exceeds the log group capacity 9433498。
> 这是因为重做日志有一个capacity变量，该值代表了最后的检查点不能超过这个阈值，
> 如果超过则必须将缓冲池（innodb buffer pool）中脏页列表（flush list）中的部分脏数据页写回磁盘，这时会导致用户线程的阻塞。
