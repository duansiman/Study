shell 和 图形用户界面，它们不是操作系统的一部分，它们是使用操作系统来完成工作

### 内核态和用户态
内核态：拥有对所以硬件的完全访问权，可以执行机器能够运行的任何指令，操作系统运行在内核态上

用户态：只能使用机器指令中的一个子集，影响机器的控制或进行I/O操作的指令，是禁止的。除了操作系统，其他的软件运行在用户态

#### CPU怎么区分内核态和用户态
为了区分是操作系统执行，还是普通程序执行，CPU有特权级别：
> Ring0 可以执行所以指令（操作系统）
> 
> Ring1（设备驱动程序）
> 
> Ring2（设备驱动程序）
> 
> Ring3 只能执行指令集中一部分指令（应用程序）

怎么知道这个指令是不是操作系统的？
> 把操作系统的代码放内存中一个特殊的区域，指令地址来自这个区域，切换到Ring0模式
> 
> 这个区域不能让应用程序访问，于是给不同内存段限定了不同的访问模式，并记录到段的描述符中

#### 内核态的进入和离开
> 中断，通知CPU
> 
> 异常，转入内核执行中断处理程序
> 
> 系统调用，

### 系统调用
1、调用程序先把系统调用函数压进堆栈

2、库过程，把系统调用的编号放在寄存器，然后执行TRAP指令，将用户态切到内核态，并在内核的固定地址开始执行

3、开始检查系统调用编号，分派给正确的系统调用处理器（指针表）

### 什么是操作系统
1、操作系统的任务是创建好的抽象，并实现和管理它所创建的的抽象对象（自顶向下）
> 计算机的体系结构（指令集、存储结构、I/O、总线结构），对于这些编程是很难的。
> 
> 硬盘：与硬盘交互的接口，很复杂且迭代速度快，最初的SATA硬盘和现在的M.2硬盘，所以有硬盘驱动的软件来硬盘交互，它提供了读写硬盘块的接口
>
> 操作系统包含很多的驱动软件

2、操作系统管理一个复杂系统的各个部分（自低向上）
> 在相互竞争的程序之间有序的控制对处理器、存储器以及其他I/O接口设备的分配
> 
> 多路复用资源：在时间上复用（CPU分配，不同的程序轮流使用）和在空间上复用（内存分配，每一个运行程序同时使用内存）